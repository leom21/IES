
var chartModule=angular.module("chartModule",[]);chartModule.directive("lineChart",["$rootScope","$timeout",function(a,b){return{retrict:"E",replace:false,template:"<svg class='lineChart'></div>",scope:{data:"=data",type:"=type",kind:"=kind",moData:"=moData",pos:"=pos"},link:function(f,e,d){if(f.type==="bell"){var c=[{key:"Normal Distribution",values:[{x:96,y:-10},{x:98,y:-8},{x:100,y:-5},{x:102,y:0},{x:104,y:1},{x:106,y:0},{x:108,y:-5},{x:110,y:-8},{x:112,y:-10}],color:"#f2f2f2"}];nv.addGraph(function(){var l=nv.models.lineChart();l.useInteractiveGuideline(false).showYAxis(false).showXAxis(false).tooltips(true).showLegend(true).margin({top:55,right:55,bottom:55,left:60});l.interpolate("basis");l.height(347);l.yAxis.tickValues(function(m){var h=["-10","-6","-2","2","6","10"];return h});l.y2Axis.tickValues(function(h){var m=["0","5","10","15","20","25"];return m});var j=e.find("svg")[0];var i=$("#bell").width();var k=$(j).height();$(window).resize(function(){i=$(j).width();k=$(j).height()});l.xAxis.tickFormat(function(m,h){return""});function g(h){d3.select(e.find("svg")[0]).datum(h).transition().duration(1500).call(l);d3.select(".nv-legend").attr("transform","translate(-"+i/2+",0)");nv.utils.windowResize(function(){l.update()})}g(c);a.$watch("curX",function(h,m){if(h!==undefined){b(function(){var o=e.find("svg")[0];var n=$(o).width();var q=((a.curX/1000)*61)/100;var p=a.curX*100},1)}})})}else{nv.addGraph(function(){var l=nv.models.lineChart();l.useInteractiveGuideline(true).showYAxis(true).showXAxis(true).showLegend(true).tooltips(false).tooltipContent(function(h,o,n,m){return"<h3>"+h+"</h3><p>"+n.value.toSizeFmt()+"</p>"}).margin({top:55,right:55,bottom:55,left:60});l.height(347);l.interactiveLayer.tooltip.contentGenerator(function(h){return h.value+"<br/>"+h.series[0].key+": "+h.series[0].value+"</div><br/>"+h.series[1].key+": "+h.series[1].value+"</div><br/>"});l.y2Axis.tickValues(function(m){var h=[];return h});l.xAxis.tickFormat(function(m,h){return m+"$"});var j=e.find("svg")[0];var i=$(j).width();var k=$(j).height();d3.select(e.find("svg")[0]).append("line").style("stroke","#d2cfcb").attr("x1",i/2+2.5).attr("y1",37).attr("x2",i/2+2.5).attr("y2",k-48).attr("stroke-dasharray","10,10");$(window).resize(function(){i=$(j).width();k=$(j).height()});d3.select(e.find("svg")[0]).append("text").attr("x",i/2).attr("y",k).style("text-anchor","middle").text("Price");d3.select(e.find("svg")[0]).append("text").style("text-anchor","middle").attr("transform","translate("+(i-15)+",150) rotate(90)").text("Probability");d3.select(e.find("svg")[0]).append("text").style("text-anchor","middle").attr("transform","translate(20,150) rotate(-90)").text("Profit");function g(h){d3.select(e.find("svg")[0]).datum(h).transition().duration(1500).call(l);d3.select(".nv-legend").attr("transform","translate("+(47)+",0)")}f.$watch("data",function(R,p){if(p!==R){var v=a.stockLast;var Q=a.moData.tgtPrc;var S=f.data;var E=[];var t=[];var D=[];var Y=[];var A=[];var K=(S.Ask+S.Bid)/2;var z=(S.Bid*100)/K;z=z.toFixed(2);var O=K/S.Strike;var U=parseFloat(z)+parseFloat((z*0.004));var M=parseFloat(U)+parseFloat((U*0.004));var n=((S.Bid+S.Ask)/2);var u=S.Strike+n;E.push(Math.round(v*(1-(2*S.PVol))),S.Strike,S.Strike+K,Math.round(v*(1+(2*S.PVol))));E.sort(function(x,w){if(x>w){return 1}});var W=(v*10)/100;var o=Math.round(v*(1-(2*S.PVol)));for(var V=0;V<E.length;V++){if(E[V]<S.Strike){var N=(((E[V]+K)/v)-1)*100;t.push(N)}else{if(E[V]==S.Strike||E[V]>S.Strike){var s=(((S.Strike+K)/v)-1)*100;t.push(s)}}}t.sort(function(x,w){if(x>w){return 1}});var N=E[1]-E[0];var L=t[1]-t[0];var r=E[2]-E[1];for(var V=0;V<E.length;V++){var L=(E[V]/v-1)*100;D.push(L)}var P=$(window).width();var B=$(j).width();var F=$(j).height();var X=((B+55)/5);$(window).resize(function(){F=$(j).height()-30;B=$(j).width()});var q=[];for(var V=0;V<D.length;V++){var L=t[V]/D[V];q.push(L)}for(var V=0;V<E.length;V++){Y.push({x:E[V],y:t[V]/100})}for(var V=0;V<E.length;V++){A.push({x:E[V],y:D[V]/100})}var H={0:-((S.PVol)*2),1:-((S.PVol)),2:0,3:((S.PVol)),4:((S.PVol)*2)};var I=(F)/5;var G=Math.round(245/5);var m={0:F-44,1:(F-44)-58,2:(F-44)-130,3:(F-44)-198,4:(F-44)-261};d3.selectAll(".yValue").remove();for(var V=0;V<5;V++){d3.select(e.find("svg")[0]).append("text").classed("yValue",true).style("text-anchor","middle").style("font-size","12px").attr("transform","translate(42,"+parseInt(m[V]+3)+")").text(Math.round(H[V]*100)+"%")}for(var V=0;V<6;V++){d3.select(e.find("svg")[0]).append("text").classed("yValue",true).style("text-anchor","middle").style("font-size","12px").attr("transform","translate("+parseInt(B-37)+","+parseInt(m[V]+3)+")").text(V*5+"%")}l.yAxis.tickFormat(function(w){});var J=[{key:"Regular",values:A,color:"#aecbc1"},{key:"Enhanced",values:Y,color:"#856f8c",area:false}];g(J);var h=[];if(v>120){if(Math.floor((v*(1+(S.PVol)))/10)*10<S.Strike){var T=(Math.floor((v*(1+(S.PVol)))/10)*10)+10}else{var T=Math.floor((v*(1+(S.PVol)))/10)*10}h.push(Math.floor((v*(1-(2*S.PVol)))/10)*10,Math.floor((v*(1-(S.PVol)))/10)*10,v,T,Math.floor((v*(1+(2*S.PVol)))/10)*10)}else{if(v<120||v>50){h.push(Math.floor(v*(1-(2*S.PVol))),Math.floor(v*(1-(S.PVol))),v,Math.floor(v*(1+(S.PVol))),Math.floor(v*(1+(2*S.PVol))))}else{if(v<50){h.push(Math.floor(v*(1-(2*S.PVol))/2),Math.floor(v*(1-(S.PVol))/2),v,Math.floor(v*(1+(S.PVol))/2),Math.floor(v*(1+(2*S.PVol))/2))}}}var C=[(Math.floor(v*(1-(2*S.PVol)))/10)*10,Math.floor(v*(1-(S.PVol))),v,Math.floor(v*(1+(S.PVol))),Math.floor(v*(1+(2*S.PVol)))];l.xAxis.tickValues(C).tickFormat(function(w){return"$"+w});l.yAxis.tickFormat(d3.format(",f"));d3.selectAll(".xValue").remove();for(var V=0;V<5;V++){d3.select(e.find("svg")[0]).append("text").classed("xValue",true).attr("x",64+(X*V)).attr("y",k-27).style("text-anchor","middle").style("font-size","12px").style("fill","black").text("")}for(var V=0;V<5;V++){d3.select(e.find("svg")[0]).append("line").classed("lTick",true).style("stroke","black").attr("x1","55").attr("y1",parseInt(m[V])).attr("x2","60").attr("y2",parseInt(m[V]))}for(var V=0;V<5;V++){d3.select(e.find("svg")[0]).append("line").style("stroke","black").classed("lTick",true).attr("x1",B-50).attr("y1",m[V]).attr("x2",B-55).attr("y2",m[V])}P=P*0.1;b(function(){var aa=window.navigator.userAgent;var y=aa.indexOf("MSIE ");if(y>0||!!navigator.userAgent.match(/Trident.*rv\:11\./)){$(".takePosition").css("margin-top","51px");var ab=document.querySelectorAll(".nv-point-2")[1];var x=d3.transform(ab.getAttribute("transform")).translate[0];var w=d3.transform(ab.getAttribute("transform")).translate[1]}else{var ab=$(".nv-series-1").find(".nv-point-2");var x=d3.transform(ab.attr("transform")).translate[0];var w=d3.transform(ab.attr("transform")).translate[1]}d3.select(".lTick").remove();d3.select(".redLine").remove();d3.select(".ep").remove();d3.select(".lp").remove();d3.select(".grad").remove();var Z=B*S.LossPercentage;a.curX=S.LossPercentage;d3.select(e.find("svg")[0]).append("line").classed("redLine",true).style("stroke","#fe1313").attr("x1",x+60).attr("y1",w+30).attr("x2",x+60).attr("y2",k-42).transition().duration(800).attr("stroke-dasharray","5,5");d3.select(e.find("svg")[0]).append("text").classed("ep",true).style("text-anchor","start").attr("transform","translate("+(x+65)+","+parseFloat(w+36)+100+") rotate(90)").text("$"+(S.Strike+K).toFixed(2));d3.select(e.find("svg")[0]).append("linearGradient").classed("grad",true).attr("id","temperature-gradient").attr("gradientUnits","userSpaceOnUse").attr("x1",x-1).attr("y1",0).attr("x2",B).attr("y2",0).selectAll("stop").data([{offset:"0%",color:"#f2f2f2"},{offset:"0.4%",color:"#ffc2c2"},{offset:"0.8%",color:"#ffc2c2"},{offset:"1%",color:"#ff8e8e"},{offset:"19%",color:"#ff8e8e"},{offset:100-S.LossPercentage*100+"%",color:"#ff8e8e"},{offset:"100%",color:"#ff8e8e"}]).enter().append("stop").attr("offset",function(ac){return ac.offset}).attr("stop-color",function(ac){return ac.color});d3.select(e.find("svg")[0]).append("text").classed("lp",true).attr("x",x+85).attr("y",(k/4)*3+30).style("text-anchor","middle").style("font-size","12px").style("fill","#fe1313").text(parseFloat(S.LossPercentage*100).toFixed(2)+"%");g(J)},350);nv.utils.windowResize(function(){l.update()})}})})}}}}]);chartModule.directive("historydChart",["$rootScope","$timeout","$compile",function(a,c,b){return{retrict:"E",replace:false,template:"<svg class='lineChart'></div>",scope:{data:"=data",position:"=position"},link:function(f,e,d){f.$watch("data",function(h,i){if(h!==undefined){angular.forEach(f.position.positions,function(j){if(j.stock===a.stockData.Symbol){f.osLast=j.stockLast;f.opLast=j.optionPrice;f.entry=j.entry}});var g=[{key:"PnL",values:[],color:"#5d4750"}];angular.forEach(f.data,function(q,o){var l=q.Date;l=l.substring(0,l.length-2);l=l.substring(6,l.length);var u=new Date(f.entry);var t=u.getDate();var p=u.getMonth();var s=u.getFullYear();var k=p+1+"/"+parseInt(t)+"/"+s;var r=new Date(k);var j=r.setDate(r.getDate()+(1*o));var m=((((q.LastStockPrice-q.LastOptionPrice)+f.opLast)/f.osLast)-1);g[0].values.push({x:l,y:m})});nv.addGraph(function(){var m=nv.models.lineChart().margin({left:50,right:35,bottom:100}).useInteractiveGuideline(true).showLegend(false).showYAxis(true).showXAxis(true).x(function(n){return n.x});m.xAxis.tickValues(function(p){var o=[];for(var n=0;n<p[0]["values"].length;n++){o.push(parseInt(p[0]["values"][n]["x"]))}return o});m.yAxis.tickFormat(function(n){return d3.time.format(",.1%")});m.xAxis.showMaxMin(false).tickFormat(function(n){return d3.time.format("%x")(new Date(n))});m.xAxis.rotateLabels(-45);var k=$(e.find("svg")[0]).width();var l=$(e.find("svg")[0]).height();$(e.find("svg")[0]).on("mousemove",function(){d3.select(".yLine").remove();d3.select(".prc").remove();var s=$(".nv-y2").offset().left;var t=$(e.find("svg")[0]).find(".hover");var r=$(t).offset().left;var q=$(t).attr("class");q=q.split("-")[3];q=q.split(" ")[0];var u=((g[0].values[q].y)*100).toFixed(2);var p=new Date(g[0].values[q].x);var o=d3.transform(t.attr("transform")).translate[0];var n=d3.transform(t.attr("transform")).translate[1];if(s==r||s-r<5){o=o-65}d3.select(e.find("svg")[0]).append("line").classed("yLine",true).style("stroke","#ccc").attr("x1","50").attr("y1",n+30).attr("x2","602").attr("y2",n+30).transition().duration(800).attr("stroke-dasharray","0,0");d3.select(e.find("svg")[0]).append("text").classed("prc",true).attr("x",o+80).attr("y",n+25).style("text-anchor","middle").text(u+"%")});m.yAxis.tickValues(function(n){return n}).tickFormat(d3.format(",.1%"));m.y2Axis.tickFormat(d3.format(",.1%"));d3.select(e.find("svg")[0]).append("text").attr("x",k/2).attr("y",l-10).style("text-anchor","middle").text("Date");function j(n){d3.select(e.find("svg")[0]).datum(n).call(m);nv.utils.windowResize(function(){m.update()});return m}j(g)})}});b(e.find("svg")[0])(f)}}}]);
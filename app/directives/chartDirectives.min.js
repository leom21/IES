
var chartModule=angular.module("chartModule",[]);chartModule.directive("lineChart",["$rootScope","$timeout",function(a,b){return{retrict:"E",replace:false,template:"<svg class='lineChart'></div>",scope:{data:"=data",type:"=type",kind:"=kind",moData:"=moData",pos:"=pos"},link:function(f,e,d){if(f.type==="bell"){var c=[{key:"Normal Distribution",values:[{x:96,y:-10},{x:98,y:-8},{x:100,y:-5},{x:102,y:0},{x:104,y:1},{x:106,y:0},{x:108,y:-5},{x:110,y:-8},{x:112,y:-10}],color:"#f2f2f2"}];nv.addGraph(function(){var l=nv.models.lineChart();l.useInteractiveGuideline(false).showYAxis(false).showXAxis(false).tooltips(true).showLegend(true).margin({top:55,right:55,bottom:55,left:60});l.interpolate("basis");l.height(347);l.yAxis.tickValues(function(m){var h=["-10","-6","-2","2","6","10"];return h});l.y2Axis.tickValues(function(h){var m=["0","5","10","15","20","25"];return m});var j=e.find("svg")[0];var i=$("#bell").width();var k=$(j).height();$(window).resize(function(){i=$(j).width();k=$(j).height()});l.xAxis.tickFormat(function(m,h){return""});function g(h){d3.select(e.find("svg")[0]).datum(h).transition().duration(1500).call(l);d3.select(".nv-legend").attr("transform","translate(-"+i/2+",0)");nv.utils.windowResize(function(){l.update()})}g(c);a.$watch("curX",function(h,m){if(h!==undefined){b(function(){var o=e.find("svg")[0];var n=$(o).width();var q=((a.curX/1000)*61)/100;var p=a.curX*100},1)}})})}else{nv.addGraph(function(){var l=nv.models.lineChart();l.useInteractiveGuideline(false).showYAxis(true).showXAxis(true).showLegend(true).tooltips(false).tooltipContent(function(h,o,n,m){return"<h3>"+h+"</h3><p>"+n.value.toSizeFmt()+"</p>"}).margin({top:55,right:55,bottom:55,left:60});l.height(347);l.interactiveLayer.tooltip.contentGenerator(function(h){return h.value+"<br/>"+h.series[0].key+": "+h.series[0].value+"</div><br/>"+h.series[1].key+": "+h.series[1].value+"</div><br/>"});l.y2Axis.tickValues(function(m){var h=[];return h});l.xAxis.tickFormat(function(m,h){return m+"$"});var j=e.find("svg")[0];var i=$(j).width();var k=$(j).height();d3.select(e.find("svg")[0]).append("line").style("stroke","#d2cfcb").attr("x1",i/2+2.5).attr("y1",37).attr("x2",i/2+2.5).attr("y2",k-48).attr("stroke-dasharray","10,10");$(window).resize(function(){i=$(j).width();k=$(j).height()});d3.select(e.find("svg")[0]).append("text").attr("x",i/2).attr("y",k).style("text-anchor","middle").text("Price");d3.select(e.find("svg")[0]).append("text").style("text-anchor","middle").attr("transform","translate("+(i-15)+",150) rotate(90)").text("Probability");d3.select(e.find("svg")[0]).append("text").style("text-anchor","middle").attr("transform","translate(20,150) rotate(-90)").text("Profit");function g(h){d3.select(e.find("svg")[0]).datum(h).call(l);d3.select(".nv-legend").attr("transform","translate("+(47)+",0)")}f.$watch("data",function(G,I){if(I!==G){var B=a.stockLast;var m=a.moData.tgtPrc;var W=f.data;var z=[];var O=[];var u=[];var o=[];var p=[];var T=(W.Ask+W.Bid)/2;var R=(W.Bid*100)/T;R=R.toFixed(2);var r=T/W.Strike;var n=parseFloat(R)+parseFloat((R*0.004));var K=parseFloat(n)+parseFloat((n*0.004));var S=((W.Bid+W.Ask)/2);var N=W.Strike+S;if(B>50){z.push(Math.round(B*(1-(2*W.PVol))),W.Strike,W.Strike+T,Math.round(B*(1+(2*W.PVol))))}else{z.push(Math.floor(B*(1-(2*W.PVol))),W.Strike,W.Strike+T,Math.floor(B*(1+(2*W.PVol))))}z.sort(function(x,w){if(x>w){return 1}});var Q=(B*10)/100;var H=Math.round(B*(1-(2*W.PVol)));for(var P=0;P<z.length;P++){if(z[P]<W.Strike){var C=(((z[P]+T)/B)-1)*100;O.push(C)}else{if(z[P]==W.Strike||z[P]>W.Strike){var h=(((W.Strike+T)/B)-1)*100;O.push(h)}}}O.sort(function(x,w){if(x>w){return 1}});var C=z[1]-z[0];var A=O[1]-O[0];var J=z[2]-z[1];for(var P=0;P<z.length;P++){var A=(z[P]/B-1)*100;u.push(A)}var F=$(window).width();var v=$(j).width();var L=$(j).height();var V=((v+55)/5);$(window).resize(function(){L=$(j).height()-30;v=$(j).width()});var t=[];for(var P=0;P<u.length;P++){var A=O[P]/u[P];t.push(A)}for(var P=0;P<z.length;P++){o.push({x:z[P],y:O[P]/100})}for(var P=0;P<z.length;P++){p.push({x:z[P],y:u[P]/100})}var M={0:-((W.PVol)*2),1:-((W.PVol)),2:0,3:((W.PVol)),4:((W.PVol)*2)};var q=(L)/5;var s=Math.round(245/5);var U={0:L-44,1:(L-44)-65,2:(L-44)-130,3:(L-44)-195,4:(L-44)-261};d3.selectAll(".yValue").remove();for(var P=0;P<5;P++){d3.select(e.find("svg")[0]).append("text").classed("yValue",true).style("text-anchor","middle").style("font-size","12px").attr("transform","translate(42,"+parseInt(U[P]+3)+")").text(Math.round(M[P]*100)+"%")}for(var P=0;P<6;P++){d3.select(e.find("svg")[0]).append("text").classed("yValue",true).style("text-anchor","middle").style("font-size","12px").attr("transform","translate("+parseInt(v-37)+","+parseInt(U[P]+3)+")").text(P*5+"%")}l.yAxis.tickFormat(function(w){});var E=[{key:"Regular",values:p,color:"#aecbc1"},{key:"Enhanced",values:o,color:"#856f8c",area:false}];g(E);if(B>50){var D=[(Math.floor(B*(1-(2*W.PVol)))/10)*10,Math.floor(B*(1-(W.PVol))),B,Math.floor(B*(1+(W.PVol))),(Math.floor(B*(1+(2*W.PVol)))/10)*10]}else{var D=[(Math.floor(B*(1-(2*W.PVol)))),Math.floor(B*(1-(W.PVol))),B,Math.ceil(B*(1+(W.PVol))),(Math.ceil(B*(1+(2*W.PVol))))]}l.xAxis.tickValues(D).tickFormat(function(w){return"$"+w});l.yAxis.tickFormat(d3.format(",f"));d3.selectAll(".xValue").remove();for(var P=0;P<5;P++){d3.select(e.find("svg")[0]).append("text").classed("xValue",true).attr("x",64+(V*P)).attr("y",k-27).style("text-anchor","middle").style("font-size","12px").style("fill","black").text("")}for(var P=0;P<5;P++){d3.select(e.find("svg")[0]).append("line").classed("lTick",true).style("stroke","black").attr("x1","55").attr("y1",parseInt(U[P])).attr("x2","60").attr("y2",parseInt(U[P]))}for(var P=0;P<5;P++){d3.select(e.find("svg")[0]).append("line").style("stroke","black").classed("lTick",true).attr("x1",v-50).attr("y1",U[P]).attr("x2",v-55).attr("y2",U[P])}F=F*0.1;b(function(){var Y=window.navigator.userAgent;var y=Y.indexOf("MSIE ");if(y>0||!!navigator.userAgent.match(/Trident.*rv\:11\./)){$(".takePosition").css("margin-top","51px");var Z=document.querySelectorAll(".nv-point-2")[1];var x=d3.transform(Z.getAttribute("transform")).translate[0];var w=d3.transform(Z.getAttribute("transform")).translate[1]}else{var Z=$(".nv-series-1").find(".nv-point-2");var x=d3.transform(Z.attr("transform")).translate[0];var w=d3.transform(Z.attr("transform")).translate[1]}d3.select(".lTick").remove();d3.select(".redLine").remove();d3.select(".ep").remove();d3.select(".lp").remove();d3.select(".grad").remove();var X=v*W.LossPercentage;a.curX=W.LossPercentage;d3.select(e.find("svg")[0]).append("line").classed("redLine",true).style("stroke","#fe1313").attr("x1",x+60).attr("y1",w+30).attr("x2",x+60).attr("y2",k-42).transition().duration(800).attr("stroke-dasharray","5,5");d3.select(e.find("svg")[0]).append("text").classed("ep",true).style("text-anchor","start").attr("transform","translate("+(x+65)+","+parseFloat(w+36)+100+") rotate(90)").text("$"+(W.Strike+T).toFixed(2));d3.select(e.find("svg")[0]).append("linearGradient").classed("grad",true).attr("id","temperature-gradient").attr("gradientUnits","userSpaceOnUse").attr("x1",x-1).attr("y1",0).attr("x2",v).attr("y2",0).selectAll("stop").data([{offset:"0%",color:"#f2f2f2"},{offset:"0.4%",color:"#ffc2c2"},{offset:"0.8%",color:"#ffc2c2"},{offset:"1%",color:"#ff8e8e"},{offset:"19%",color:"#ff8e8e"},{offset:100-W.LossPercentage*100+"%",color:"#ff8e8e"},{offset:"100%",color:"#ff8e8e"}]).enter().append("stop").attr("offset",function(aa){return aa.offset}).attr("stop-color",function(aa){return aa.color});d3.select(e.find("svg")[0]).append("text").classed("lp",true).attr("x",x+85).attr("y",(k/4)*3+30).style("text-anchor","middle").style("font-size","12px").style("fill","#fe1313").text(parseFloat(W.LossPercentage*100).toFixed(2)+"%");g(E)},350)}})})}}}}]);chartModule.directive("historydChart",["$rootScope","$timeout","$compile",function(a,c,b){return{retrict:"E",replace:false,template:"<svg class='lineChart'></div>",scope:{data:"=data",position:"=position"},link:function(f,e,d){f.$watch("data",function(h,i){if(h!==undefined){angular.forEach(f.position.positions,function(j){if(j.stock===a.stockData.Symbol){f.osLast=j.stockLast;f.opLast=j.optionPrice;f.entry=j.entry}});var g=[{key:"PnL",values:[],color:"#5d4750"}];angular.forEach(f.data,function(q,o){var l=q.Date;l=l.substring(0,l.length-2);l=l.substring(6,l.length);var u=new Date(f.entry);var t=u.getDate();var p=u.getMonth();var s=u.getFullYear();var k=p+1+"/"+parseInt(t)+"/"+s;var r=new Date(k);var j=r.setDate(r.getDate()+(1*o));var m=((((q.LastStockPrice-q.LastOptionPrice)+f.opLast)/f.osLast)-1);g[0].values.push({x:l,y:m})});nv.addGraph(function(){var m=nv.models.lineChart().margin({left:50,right:35,bottom:100}).useInteractiveGuideline(true).showLegend(false).showYAxis(true).showXAxis(true).x(function(n){return n.x});m.xAxis.tickValues(function(p){var o=[];for(var n=0;n<p[0]["values"].length;n++){o.push(parseInt(p[0]["values"][n]["x"]))}return o});m.yAxis.tickFormat(function(n){return d3.time.format(",.1%")});m.xAxis.showMaxMin(false).tickFormat(function(n){return d3.time.format("%x")(new Date(n))});m.xAxis.rotateLabels(-45);var k=$(e.find("svg")[0]).width();var l=$(e.find("svg")[0]).height();m.yAxis.tickValues(function(n){return n}).tickFormat(d3.format(",.1%"));m.y2Axis.tickFormat(d3.format(",.1%"));d3.select(e.find("svg")[0]).append("text").attr("x",k/2).attr("y",l-10).style("text-anchor","middle").text("Date");function j(n){d3.select(e.find("svg")[0]).datum(n).call(m);nv.utils.windowResize(function(){m.update()});return m}j(g);e.on("mousemove",function(){d3.select(".yLine").remove();d3.select(".prc").remove();var n=window.navigator.userAgent;var t=n.indexOf("MSIE ");if(t>0||!!navigator.userAgent.match(/Trident.*rv\:11\./)){var p=e.find("svg")[0].querySelector(".hover");var v=d3.transform(p.getAttribute("transform")).translate[0];var u=d3.transform(p.getAttribute("transform")).translate[1]}else{var p=$(e.find("svg")[0]).find(".hover");var v=d3.transform(p.attr("transform")).translate[0];var u=d3.transform(p.attr("transform")).translate[1];d3.select(e.find("svg")[0]).append("line").classed("yLine",true).style("stroke","#ccc").attr("x1","50").attr("y1",u+30).attr("x2","602").attr("y2",u+30).transition().duration(800).attr("stroke-dasharray","0,0")}var r=$(".nv-y2").offset().left;var o=$(p).offset().left;var w=$(p).attr("class");w=w.split("-")[3];w=w.split(" ")[0];var s=((g[0].values[w].y)*100).toFixed(2);var q=new Date(g[0].values[w].x);if(r==o||r-o<5){v=v-65}d3.select(e.find("svg")[0]).append("text").classed("prc",true).attr("x",v+80).attr("y",u+25).style("text-anchor","middle").text(s+"%")})})}})}}}]);

var dashboardCtrl=angular.module("dashboardCtrl",["dashBoardServicesModule"]);dashboardCtrl.filter("customerPagination",["$rootScope",function(a){return function(d,c,b){return d.slice(c,b)}}]);dashboardCtrl.filter("searchSym",[,function(){return(function(c,b){if(b){b=b.toLowerCase();var a=[];angular.forEach(c,function(d){if(d.symbol.toLowerCase().indexOf(b)!==-1){a.push(d)}});return a}})}]);dashboardCtrl.filter("searchHistory",["$rootScope",function(a){return(function(d,c){if(c){c=c.toLowerCase();var b=[];angular.forEach(d,function(e){if(e.symbol.toLowerCase().indexOf(c)!==-1){b.push(e)}});a.SH=b;(b.length==0)?$(".searchHistory").hide():$(".searchHistory").show();return a.SH}else{$(".searchHistory").hide()}})}]);dashboardCtrl.controller("stockCtrl",["$scope","$rootScope","dashboardFactory","$state",function(d,b,f,e){d.pos=b.userPositions.positions;var c=[];d.curr=function(a){};if(d.pos.length==0){d.hasPositions=false;$(".loadingView").delay(400).fadeOut(150);d.msg="You haven't taken any poitions yet. Please search a symbol from the above search bar in order\n                to take a postion."}else{angular.forEach(d.pos,function(a){c.push(a.leg)});d.currPrc={};f.getPositionData(c).then(function(a){angular.forEach(a,function(g){d.currPrc[g.Name]={curr:(g.Ask+g.Bid)/2}})});d.hasPositions=true;d.pnl=function(h,g){var a=(((h-g)/g)*100).toFixed(2);if(a==-0){return 0+"%"}else{return(((h-g)/g)*100).toFixed(2)+"%"}};d.editDate=function(a){if(a){a=a.substring(0,a.length-2);a=a.substring(6,a.length);return a}};d.deletePosition=function(g,a){var i=g[0].name;var h=confirm("You are about to remove the possition of "+i+".");if(h==true){f.deletePosition(a).then(function(j){if(j=="OK"){e.go(e.current,{},{reload:true})}})}}}}]);dashboardCtrl.controller("watchlistCtrl",["$scope","$rootScope","$http","dashboardFactory",function(b,a,d,c){a.$watch("watchlist",function(g,h){if(g!==h||g!==undefined){b.wl=a.watchlist;if(b.wl==null||b.wl=="null"||b.wl==undefined||b.wl==0||b.wl=="0"){b.wl=false;$(".loadingView").fadeOut(400);b.msg="The list is empty. You can add stocks to your watch list by clicking the ''Add to my watch list'' icon in the stock's page."}else{b.wlist=a.watchlist.split(",");b.wl=true;b.pnl=function(j,i){return(((j-i)/i)*100).toFixed(2)+"%"};b.arr=[];var f=[];for(var e=1;e<b.wlist.length;e++){if(b.wlist[e]!==""){f.push(b.wlist[e])}}c.getStock(f).then(function(i){if(i.length==0){b.wl=false;b.msg="It seems that we cannot find the symbols you are watching. Please try again shortly or contact support."}else{angular.forEach(i,function(j){b.arr.push(j)})}});b.removeWL=function(k){var m=a.watchlist.split(",");var j=m.indexOf(k);m.splice(j,1);var l=m.toString();c.removeWL(l).then(function(i){if(i=="OK"){b.onList=false}})}}}})}]);dashboardCtrl.controller("dashboardCtrl",["$scope","$rootScope","$http","$state","$timeout","dashboardFactory","toolTip",function(b,a,h,f,e,g,d){b.logout=function(){g.logout()};b.toolTip=function(l,n){var i=n.pageX;var o=$(n.target).offset().top;var m=d.showContent(l);$(".toolTip").html(m);var j=$(".toolTip").width();var k=$(".toolTip").height();$(".toolTip").css({left:i+"px","margin-left":(-j/2)-5+"px",top:o+"px","margin-top":-k*2+5+"px"});$(".toolTip").show()};b.toolTipOut=function(){$(".toolTip").hide()};b.closeMe=false;b.focus=false;b.clickPos=function(i){var j=i.target.className;if(j!=="showHistoryList"){b.closeMe=true}};b.stocks=[];b.showList=function(i){if(i.keyCode!==13){$(".searchHistory").show()}else{$(".searchHistory").hide()}};b.dropDownList=function(){$(".searchHistoryList").toggle();b.searchQ=""};a.$on("$stateChangeStart",function(l,i,k,m,j){});a.$on("$stateChangeSuccess",function(l,i,k,m,j){$(".searchHistoryList").hide();$(".searchQ").val("");b.searchQ=""});function c(i){if(i=="show"){$(".bar").fadeIn(200)}if(i=="hide"){$(".loading").fadeOut(150);$(".searchHistory").hide();$(".bar").fadeOut(400);$(".progress").css({width:"0%"})}}b.clickedStock=function(j){b.srcQ=j;$(".srcQ").val(j);var i=document.querySelector(".hQty");i.focus();i.value=100};b.searchStockForm=function(i){f.go("dashboard.index");if(i==null){var i=$(".searchQ").val()}c("show");g.searchStock(i).then(function(j){e(function(){c("hide");b.stocks=j;b.pagesCount=[];var k=Math.ceil(b.stocks.length/b.itemsPerPage);for(var l=1;l<k+1;l++){b.pagesCount.push({number:l})}b.$apply()},500)})};b.seeStock=function(i){$(".searchQ").val(i);c("show");b.searchStockForm(i)};b.moveToStock=function(k,l){k=$(".srcQ").val();var j=$(".hQty").val();var i=/^[a-zA-Z]+$/;var m=/^[0-9]+$/;if(!k){$(".symE").text("Please fill in a stock symbol.");return false}if(!k.match(i)){$(".symE").text("Only letters are allowd.");$(".searchQ").val("");return false}if(!j){if(l){$(".hQty").val("sq");b.held=l;j=l;$(".symE").text("");$(".qtyE").text("");f.go("dashboard.data",{s:k,q:l});g.clickHistory(k)}else{$(".symE").text("");$(".qtyE").text("");f.go("dashboard.data",{s:k,q:100});g.clickHistory(k);b.held=100}}else{if(!j.match(m)){$(".qtyE").text("Please fill in a number.");return false}if(j<100){$(".qtyE").text("The minimum quantity is 100.");return false}if(j%1!==0){$(".qtyE").text("Please fill in a whole number.");return false}else{$(".symE").text("");$(".qtyE").text("");f.go("dashboard.data",{s:k,q:j});g.clickHistory(k);b.held=j}}}}]);dashboardCtrl.controller("stockdataCtrl",["$scope","$rootScope","$http","$state","$timeout","dashboardFactory",function(b,a,h,e,d,f){b.symbol=e.params.s.toUpperCase();delete a.stockData;var g=e.params.q;if(g.length==0){a.held=100}else{a.held=Math.floor(parseInt(e.params.q))}b.editDate=function(i){if(i){i=i.substring(0,i.length-2);i=i.substring(6,i.length);return i}};var c=false;b.cut=function(i){return Math.floor(i*100)/100};b.selectedRow=null;d(function(){b.gotPosition=false;f.getStock(b.symbol).then(function(l){if(l.length==0){b.noR=true}a.stockData=l[0];if(a.watchlist.indexOf(b.symbol)!==-1&&b.symbol==a.stockData.Symbol){b.onList=true}else{b.onList=false}var j=$(".dataContainer").width()+$(".dataContainer").position().left;var k=$(".takePosition").width();var n=$(".score").width();var m=$(".dataContainer").position().left+10;$(".takePosition").css("left",j-k-7+"px");$(".score").css("left",j-n-7-m+"px");a.stockLast=a.stockData.Last;a.moData={last:a.stockData.Last,tgtPrc:a.stockData.TgtPrc};if(a.userPositions.positions.length>0){var i=0;angular.forEach(a.userPositions.positions,function(q){if(q.stock==a.stockData.Symbol){b.gotPosition=true;a.stData=a.stockData;i=1;var r=q.position[0].name;var z=[];var t=new Date(q.entry);var y=t.getDate();var w=t.getMonth();var x=t.getFullYear();var v=t.getHours();var u=t.getMinutes();var p=t.getSeconds();var s=w+1+"/"+y+"/"+x+" "+v+":"+u+":"+p;angular.forEach(b.stockData.Options,function(o){z.push(o.Name)});var A=$.inArray(r,z);if(A>-1){f.getStockHistory(b.symbol,s,r).then(function(o){b.historyData=o;a.HisLength=o.length;if(b.historyData.length<2){$(".noHismsg").show()}});f.getPositionData([r]).then(function(o){a.PositionPrices=o[0]})}else{f.getStockHistory(b.symbol,s,r).then(function(o){b.historyData=o;a.HisLength=o.length;if(b.historyData.length<2){$(".noHismsg").show()}});f.getPositionData([r]).then(function(o){a.PositionPrices=o[0]})}angular.forEach(b.stockData.Options,function(G){if(G.Name==r){a.stData=a.stockData;a.position=G;console.log(G);a.LossPercentage=G.LossPercentage}else{console.log("!");a.stData=a.stockData;var C=new Date(q.entry);var I=C.getDate();var F=C.getMonth();var H=C.getFullYear();var E=C.getHours();var D=C.getMinutes();var o=C.getSeconds();var B=F+1+"/"+I+"/"+H+" "+E+":"+D+":"+o}})}else{b.historyData=[];a.position=b.stockData.Options[0];a.LossPercentage=a.position.LossPercentage}})}else{a.position=b.stockData.Options[0]}})},600);b.removeWL=function(k){var m=a.watchlist.split(",");var j=m.indexOf(k);m.splice(j,1);var l=m.toString();f.removeWL(l).then(function(i){if(i=="OK"){b.onList=false}})};b.showStockPrice=function(){b.showStockP=true;angular.forEach(b.historyData,function(i){i.LastStockPrice})};b.legPrice=function(k,j){var i=(k+j)/2;return"$"+(Math.ceil(i*100)/100).toFixed(2)};b.addToWL=function(i){f.addToWL(i,a.userId).then(function(j){b.onList=true})};b.reDrawGraph=function(j,k){a.showPosition=true;b.selectedRow=j;a.position=k}}]);
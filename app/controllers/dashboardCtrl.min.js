
var dashboardCtrl=angular.module("dashboardCtrl",["dashBoardServicesModule"]);dashboardCtrl.filter("customerPagination",["$rootScope",function(a){return function(d,c,b){return d.slice(c,b)}}]);dashboardCtrl.filter("searchSym",[,function(){return(function(c,b){if(b){b=b.toLowerCase();var a=[];angular.forEach(c,function(d){if(d.symbol.toLowerCase().indexOf(b)!==-1){a.push(d)}});return a}})}]);dashboardCtrl.filter("searchHistory",["$rootScope",function(a){return(function(d,c){if(c){c=c.toLowerCase();var b=[];angular.forEach(d,function(e){if(e.symbol.toLowerCase().indexOf(c)!==-1){b.push(e)}});a.SH=b;(b.length==0)?$(".searchHistory").hide():$(".searchHistory").show();return a.SH}else{$(".searchHistory").hide()}})}]);dashboardCtrl.controller("stockCtrl",["$scope","$rootScope","dashboardFactory","$state",function(d,b,f,e){d.pos=b.userPositions.positions;var c=[];d.curr=function(a){};if(d.pos.length==0){d.hasPositions=false;$(".loadingView").fadeOut(1);d.msg="You haven't taken any poitions yet. Please search a symbol from the above search bar in order\nto take a postion."}else{angular.forEach(d.pos,function(a){c.push(a.stock)});d.currPrc={};f.getStock(c).then(function(a){angular.forEach(a,function(g){angular.forEach(g.Options,function(h){d.currPrc[h.Name]={curr:(h.Ask+h.Bid)/2}})})});d.hasPositions=true;d.pnl=function(h,g){var a=(((h-g)/g)*100).toFixed(2);if(a==-0){return 0+"%"}else{return(((h-g)/g)*100).toFixed(2)+"%"}};d.editENDate=function(a){if(a){}};d.editDate=function(a){if(a){a=a.substring(0,a.length-2);a=a.substring(6,a.length);return a}};d.deletePosition=function(g,a){var i=g[0].name;var h=confirm("You are about to remove the possition of "+i+".");if(h==true){f.deletePosition(a).then(function(j){if(j=="OK"){e.go(e.current,{},{reload:true})}})}}}}]);dashboardCtrl.controller("watchlistCtrl",["$scope","$rootScope","$http","dashboardFactory",function(b,a,d,c){a.$watch("watchlist",function(g,h){if(g!==h||g!==undefined){b.wl=a.watchlist;if(b.wl==null||b.wl=="null"||b.wl==undefined||b.wl==0||b.wl=="0"){b.wl=false;$(".loadingView").fadeOut(1);b.msg="The list is empty. You can add stocks to your watch list by clicking the ''Add to my watch list'' icon in the stock's page."}else{$(".loadingView").fadeOut(1);b.wlist=a.watchlist.split(",");b.wl=true;b.pnl=function(j,i){return(((j-i)/i)*100).toFixed(2)+"%"};b.arr=[];var f=[];for(var e=1;e<b.wlist.length;e++){if(b.wlist[e]!==""){f.push(b.wlist[e])}}c.getStock(f).then(function(i){if(i.length==0){b.wl=false;b.msg="It seems that we cannot find the symbols you are watching. Please try again shortly or contact support."}else{angular.forEach(i,function(j){b.arr.push(j)})}});b.removeWL=function(k){var m=a.watchlist.split(",");var j=m.indexOf(k);m.splice(j,1);var l=m.toString();c.removeWL(l).then(function(i){if(i=="OK"){b.onList=false}})}}}})}]);dashboardCtrl.controller("dashboardCtrl",["$scope","$rootScope","$http","$state","$timeout","dashboardFactory",function(b,a,g,e,d,f){b.logout=function(){f.logout()};b.closeMe=false;b.focus=false;b.clickPos=function(h){var i=h.target.className;if(i!=="showHistoryList"){b.closeMe=true}};b.stocks=[];b.showList=function(h){if(h.keyCode!==13){$(".searchHistory").show()}else{$(".searchHistory").hide()}};b.dropDownList=function(){$(".searchHistoryList").toggle();b.searchQ=""};a.$on("$stateChangeStart",function(k,h,j,l,i){});a.$on("$stateChangeSuccess",function(k,h,j,l,i){$(".searchHistoryList").hide();$(".searchQ").val("");b.searchQ=""});function c(h){if(h=="show"){$(".bar").fadeIn(200)}if(h=="hide"){$(".loading").fadeOut(150);$(".searchHistory").hide();$(".bar").fadeOut(400);$(".progress").css({width:"0%"})}}b.clickedStock=function(i){b.searchQ=i;var h=document.querySelector(".hQty");h.focus();h.value=100};b.searchStockForm=function(h){e.go("dashboard.index");if(h==null){var h=$(".searchQ").val()}c("show");f.searchStock(h).then(function(i){d(function(){c("hide");b.stocks=i;b.pagesCount=[];var j=Math.ceil(b.stocks.length/b.itemsPerPage);for(var k=1;k<j+1;k++){b.pagesCount.push({number:k})}b.$apply()},500)})};b.seeStock=function(h){$(".searchQ").val(h);c("show");b.searchStockForm(h)};b.moveToStock=function(j,k){var i=$(".hQty").val();var h=/^[a-zA-Z]+$/;var l=/^[0-9]+$/;if(!j){$(".symE").text("Please fill in a stock symbol.");return false}if(!j.match(h)){$(".symE").text("Only letters are allowd.");$(".searchQ").val("");return false}if(!i){if(k){$(".hQty").val("sq");b.held=k;i=k;$(".symE").text("");$(".qtyE").text("");e.go("dashboard.data",{s:j,q:k});f.clickHistory(j)}else{if(!i.match(l)){$(".qtyE").text("Please fill in a number.");return false}$(".qtyE").text("Please fill in held quanitiy.");return false}}else{$(".symE").text("");$(".qtyE").text("");e.go("dashboard.data",{s:j,q:i});f.clickHistory(j);b.held=i}};b.showing=function(){if(b.stocks.length<b.currentPage*b.itemsPerPage){return b.stocks.length}else{if(b.stocks.length==0){return b.stocks.length}else{return b.currentPage*b.itemsPerPage}}};b.outOfPages=function(){if(b.stocks.length==0){return Math.ceil(b.stocks.length/b.itemsPerPage)}else{return Math.ceil(b.stocks.length/b.itemsPerPage)}};b.Math=window.Math;b.startLimit=0;b.endLimit=20;b.currentPage=1;b.itemsPerPage=20;b.totalItems=b.stocks.length;b.pages=Math.ceil(b.totalItems/b.itemsPerPage);b.nextPage=function(){b.currentPage=b.currentPage+1;b.startLimit=b.startLimit+b.itemsPerPage;b.endLimit=b.endLimit+b.itemsPerPage};b.prevPage=function(){b.currentPage=b.currentPage-1;b.startLimit=b.startLimit-b.itemsPerPage;b.endLimit=b.endLimit-b.itemsPerPage};b.moveToPage=function(h){b.currentPage=h+1;b.startLimit=b.itemsPerPage*h;b.endLimit=b.itemsPerPage+(b.itemsPerPage*h)}}]);dashboardCtrl.controller("stockdataCtrl",["$scope","$rootScope","$http","$state","$timeout","dashboardFactory",function(b,a,h,e,d,f){b.symbol=e.params.s.toUpperCase();var g=e.params.q;if(g.length==0){a.held=100}else{a.held=Math.floor(parseInt(e.params.q))}b.editDate=function(i){if(i){i=i.substring(0,i.length-2);i=i.substring(6,i.length);return i}};var c=false;b.cut=function(i){return Math.floor(i*100)/100};b.selectedRow=null;d(function(){b.gotPosition=false;f.getStock(b.symbol).then(function(k){if(k.length==0){b.noR=true}a.stockData=k[0];if(a.watchlist.indexOf(b.symbol)!==-1&&b.symbol==a.stockData.Symbol){b.onList=true}else{b.onList=false}var i=$(".dataContainer").width()+$(".dataContainer").position().left;var j=$(".takePosition").width();var m=$(".score").width();var l=$(".dataContainer").position().left+10;$(".takePosition").css("left",i-j-7+"px");$(".score").css("left",i-m-7-l+"px");a.$watch("stockData",function(o,p){a.stockLast=a.stockData.Last;a.moData={last:a.stockData.Last,tgtPrc:a.stockData.TgtPrc};if(a.userPositions.positions.length>0){var n=0;angular.forEach(a.userPositions.positions,function(q){if(q.stock==a.stockData.Symbol){b.gotPosition=true;n=1;var r=q.position[0].name;angular.forEach(b.stockData.Options,function(y){if(y.Name==r){a.stData=a.stockData;a.position=y;a.LossPercentage=y.LossPercentage;var u=new Date();var A=u.getDate();var x=u.getMonth();var z=u.getFullYear();var w=u.getHours();var v=u.getMinutes();var s=u.getSeconds();var t=A+1+"/"+x+"/"+z+" "+w+":"+v+":"+s;f.getStockHistory("QQQ",t,r).then(function(B){a.historyData=B})}})}else{a.position=b.stockData.Options[0];a.LossPercentage=a.position.LossPercentage}})}else{a.position=b.stockData.Options[0]}})})},600);b.removeWL=function(k){var m=a.watchlist.split(",");var j=m.indexOf(k);m.splice(j,1);var l=m.toString();f.removeWL(l).then(function(i){if(i=="OK"){b.onList=false}})};b.showStockPrice=function(){b.showStockP=true;angular.forEach(a.historyData,function(i){i.LastStockPrice})};b.addToWL=function(i){f.addToWL(i,a.userId).then(function(j){b.onList=true})};b.reDrawGraph=function(j,k){a.showPosition=true;b.selectedRow=j;a.position=k}}]);